迪士尼PBR白皮书 https://media.disneyanimation.com/uploads/production/publication_asset/48/asset/s2012_pbs_disney_brdf_notes_v3.pdf
The PBR Guide https://www.adobe.com/learn/substance-3d-designer/web/the-pbr-guide-part-1
The PBR Guide https://www.adobe.com/learn/substance-3d-designer/web/the-pbr-guide-part-2

#折射率IOR（Index of Refraction）
{
	#Snell Law
	n1 * sin(theta1) = n2 * sin(theta2)
		n1: 入射介质的折射率
		n2: 折射介质的折射率
		theta1: 入射角（光线与法线的夹角）
		theta2: 折射角（折射光线与法线的夹角）
	
	#金属的复数折射率	
	IOR = n + ik
		n: 实部折射率，描述光线在金属表面发生折射的能力
		k: 虚部消光系数（Extinction Coefficient），描述光线在金属内部传播时的能量吸收程度
		i: 虚数单位（满足i^2=-1）
		
	#常见材质的 IOR 值
		空气: 1.0003
		水: 1.33
		冰: 1.31
		普通玻璃: 1.5
		钻石: 2.42
		塑料: 1.45 - 1.6
		石英: 1.54
		金: (0.47 + 2.35i)
		银: (0.16 + 4.1i)
		铜: (0.64 + 2.54i)
		铝: (1.28 + 7.68i)
}

#反射率
{
	#Fresnel Equations
		'垂直偏振光（Perpendicular Polarized Light）'：Rs = ((n1 * cos(theta1) - n2 * cos(theta2)) / (n1 * cos(theta1) + n2 * cos(theta2)))^2
		'平行偏振光（Parallel Polarized Light）'：	    Rp = ((n1 * cos(theta2) - n2 * cos(theta1)) / (n1 * cos(theta2) + n2 * cos(theta1)))^2
		'总反射率'：R = (Rs + Rp) / 2
		#适用条件
			界面光滑
			均匀各向同性介质
			单一波长光线
			无表面吸收
			
	#Schlick 近似
		'Fresnel 反射率'：F(theta) = F0 + (1 - F0) * (1 - cos(theta))^5
		'F0（法线方向反射率，垂直入射）':
			#非金属材质（Dielectric）：
				灰度值[0.02-0.05]
				F0通常由'折射率'计算得出
				F0 = ((n1 - n2) / (n1 + n2))^2
			#金属材质（Metallic）
				RGB[0.5-1.0]
				F0是'材质的镜面反射颜色'（一般由'艺术家定义'或'测量'）
		'F90（掠射角方向反射率）'
			F90 = F(90)
			控制'掠射角'（光线几乎平行于表面）的反射行为，模拟'强反射效果'
			#反射强度增强
				'Fresnel效应': 在掠射角，反射率急剧增加，趋近于1（完全反射）
				物理原因：
					光线接近平行表面时，光的'电场分量与表面方向更加对齐'，导致'更多光被反射'而非折射
					特别是'金属表面'，掠射角反射率几乎恒定为1
					
	#微表面理论 引入粗糙度
		#光滑表面（低粗糙度）
			Fresnel 效应表现强烈。
			'掠射角方向'的'反射率'接近 1
			'表面反射光'集中在'一个方向'，镜面高光'清晰'
		#粗糙表面（高粗糙度）
			Fresnel 效应在'掠射角方向'依然'有效'，但视觉表现'被散射弱化'
			'镜面反射'变得'模糊'，'掠射角高反射'的'特点'不明显	
	
	#掠射逆反射
		掠射角下，'入射光'与'表面法线'几乎'垂直'，传统的反射模型会假设'反射光主要分布'在入射光的'镜面反射方向'
		某些表面材质（特别是'粗糙材质'或'布料'）在'掠射角'表现出明显'逆反射'行为，即部分光线'反射回入射方向'
		光滑材质在'掠射角'会'更暗'
		
		#成因
			1 微表面分布效应
				在粗糙表面或具有显著微表面分布的材质中，大量微表面的法线方向会偏离平均法线。
				当光以掠射角入射时，这些偏离的微表面可能反射光线回到光源方向，从而产生逆反射效果。
			2. 次表面散射（SSS）
				半透明材质（如皮肤、大理石、蜡）中，光线可能穿透表面，经过多次散射后沿着入射方向返回。
				这种现象特别明显于某些高散射率的材料。
			3. 几何遮蔽效应
				在掠射角下，大量微表面区域会由于几何遮蔽而失去直接反射的光线。
				剩余的光线倾向于被“重新导向”到入射方向。
		#建模
		{
			#修正微表面分布函数 D(H)
			{
				在 GGX 分布或 Beckmann 分布的基础上，通过调整分布密度，使掠射角下的微表面法线倾向于回归入射方向。
				公式：
					D'(H) = D(H) * f(cos(θ), Roughness)
				说明：
					- D(H)：原始的微表面分布函数（例如 GGX 分布）。
					- f 是一个附加函数，用于增加掠射角下的逆反射效果。
					- Roughness：表面粗糙度参数。
			}

			#修正几何遮蔽函数 G
			{
				通过改变几何遮蔽项，使得掠射角时更多的光线被反射回入射方向。
				公式：
					G'(N, V, L) = G(N, V, L) * g(cos(θ), Roughness)
				说明：
					- G 是原始的几何遮蔽函数。
					- g 是一个依赖掠射角的调整函数。
			}

			#引入散射效应
			{
				加入次表面散射项，模拟光线穿透并返回的效果。
				公式：
					L = F * D * G + SSS
				说明：
					- L：最终反射光。
					- F：Fresnel 反射率。
					- D：微表面分布函数。
					- G：几何遮蔽函数。
					- SSS：次表面散射项，用于模拟逆反射效果。
				次表面散射项近似：
					SSS = DiffusionProfile(N, L) * max(0, N · L)
				其中：
					- DiffusionProfile 是基于高斯分布或指数函数的漫反射近似函数。
					- N · L 表示光线入射方向的角度权重。
			}

			#实验性混合模型
			{
				通过混合逆反射 BRDF 和常规 BRDF，创建一种更符合视觉需求的效果。
				伪代码：
					vec3 retroReflection(vec3 normal, vec3 lightDir, vec3 viewDir, float roughness) {
						float grazingEffect = pow(max(dot(normal, lightDir), 0.0), roughness * 10.0);
						return grazingEffect * albedo * (viewDir + lightDir) * 0.5;
					}
			}
		}
}

#Base Color
{
	#金属材质
		baseColor = F0
	#非金属性材质
		baseColor = albedo
		对于'电介质'
}

#线性空间渲染（Linear Space Rendering）
	人类视觉系统 (HVS) 对'暗色调'的相对差异比'亮色调'更'敏感'
	#sRGB贴图
		base color, diffuse, specular and emissive
	#Linear贴图
		roughness, ambient occlusion, normal, metallic, and height
		
#Diffuse模型
{
	PBR 漫反射公式汇总

	#Lambert（光滑表面）
	{
	公式:
		L_d = Albedo * (1 / pi) * max(0, N . L)
	特点:
		- 假设表面反射'均匀分布'
		- 简单高效，适合大多数情况
		- '不考虑次表面散射'或微表面分布
	限制:
		- '不适合'模拟真实材质的'能量守恒'
		- 无法处理复杂材质的次表面散射或多重反射。
	}

	#Oren-Nayar（粗糙度）
	{
	公式:
		L_d = Albedo * (1 / pi) * (N . L) * A + B * max(0, V . H)

		A = 1 - (sigma^2) / (2 * (sigma^2 + 0.33))
		B = 0.45 * (sigma^2) / (sigma^2 + 0.09)
		H = (L + V) / |L + V|
	特点:
		- 模拟了'表面粗糙度'对漫反射的影响
		- 引入了'粗糙度'参数 sigma 来控制'微表面散射'
	优点:
		- '更适合粗糙表面'，例如纸张、布料等
		- 考虑了'入射光'和'观察方向'之间的关系
	限制:
		- 计算开销较大
		- 在非常光滑的表面上与 Lambert 相比无显著优势
	与实际对比:
		- 掠射逆反射峰值'不够尖锐'
		- 漫反射形状'不够平坦'
	}

	#Burley Diffuse（迪士尼漫反射）
	{
	公式:
		L_d = Albedo * (1 / pi) * (FD90 + (1 - FD90) * (1 - L . N)^5)

		FD90 = 0.5 + 2 * (L . N)^2 * Roughness
	特点:
		- 由迪士尼提出，用于其 PBR 材质模型
		- 考虑了'粗糙度'对'掠射角'散射的影响
		- 更'符合能量守恒'原则
	优点:
		- '更精确'地描述了'粗糙表面'的漫反射特性
		- '掠射角'光照表现更符合物理规律
	}

	#Minnaert Diffuse（如粉末、织物等
	{
	公式:
		L_d = Albedo * (1 / pi) * (N . L)^k
	特点:
		- 引入指数 k 来调整光线的衰减方式。
		- k > 1：增强掠射光。
		- k < 1：减弱掠射光。
	优点:
		- 适用于表现一些'特殊材质（如粉末、织物等）'的散射行为
	限制:
		- '无法处理'复杂材质的'微表面反射'
	}

	#Lambert-Schlick（Lambert粗糙度改进）
	{
	公式:
		L_d = Albedo * (1 / pi) * (N . L) * (1 + Roughness * (1 - (N . L)))

	特点:
		- 基于 Lambert 模型，通过'引入粗糙度'参数调整反射强度
		- 更适合 PBR 中的粗糙表面

	优点:
		- 计算开销较小，适用于实时渲染
		- 与'Oren-Nayar'类似，但'更简单'
	}

	#Subsurface Scattering（次表面散射）
	{
	公式（近似）:
		L_d = Albedo * (1 - F0) * SSS

		次表面散射部分通常通过'双向散射分布函数（BSSRDF）'或预计算来模拟

	特点:
		- 适用于'半透明材质'（如皮肤、大理石、蜡）
		- 次表面散射公式本身非常复杂，通常采用'近似模拟'
	}

	#Energy-Conserving Diffuse（能量守恒）
	{
	公式:
		L_d = Albedo * (1 / pi) * (1 - F) * (N . L)

	特点:
		- 将'Fresnel效应'加入'漫反射计算'
		- 避免在高反射率材质中出现不符合物理规律的亮度
	}

	#总结
	模型                	| 特点                               | 适用场景
	-------------------	|-----------------------------------|----------------
	Lambert            	| 最基础、高效，适合'简单光滑材质'       	| 标准材质，实时渲染
	Oren-Nayar         	| 考虑'粗糙度'，模拟真实散射           	| 布料、粗糙表面
	Burley（迪士尼）   	| 简化'能量守恒'，考虑'掠射角和粗糙度'	| 高质量渲染，PBR 标准
	Minnaert           	| 自定义散射指数，模拟'特殊反射'行为   	| 粉末、织物
	Lambert-Schlick    	| '粗糙度调整'的高效'Lambert'         	| 实时渲染，粗糙材质
	次表面散射（SSS）  	| 模拟'半透明材质'的散射               	| 皮肤、蜡、大理石
	能量守恒模型       	| 加入 'Fresnel效应'以符合物理规律     	| 高质量渲染，PBR 实践
}

#Cook-Torrance Specular D模型
{
	描述微表面法线（与宏观法线的偏差）的分布概率
	通过retroreflective responses of the measured materials观察到
	'镜面反射波瓣'f(θh)
	
	#Beckmann 分布函数
	{
		公式:
			D(h) = exp(-tan^2(θ_h) / α^2) / (π α^2 cos^4(θ_h))
			- θ_h：半程向量 H 和法线 N 的夹角。
			- α：粗糙度参数，控制表面微表面分布的范围。
		特点:
			- 源自光滑表面的微表面理论，适合模拟光滑或中等粗糙度的表面。
			- 分布集中且快速衰减，表现出光滑材质的镜面反射特性。
		优点:
			- 模型精确，基于物理理论。
			- 适用于玻璃、抛光金属等光滑表面。
		缺点:
			- 当粗糙度较高时，衰减过快，不适合表现粗糙材质。
			- 计算量相对较大。
	}

	#GGX（Trowbridge-Reitz）分布函数
	{
		公式:
			D(h) = α^2 / (π ((cos^2(θ_h) (α^2 - 1) + 1)^2))
			- α：粗糙度参数（与 Beckmann 类似）。
		特点:
			- 分布尾部衰减较慢（“长尾”分布），适合表现粗糙表面的镜面反射。
			- 现已成为 PBR 渲染中的主流分布函数。
		优点:
			- 能更好地模拟粗糙材质（如拉丝金属、塑料表面）。
			- 计算效率高，适合实时渲染。
		缺点:
			- 对非常光滑的表面，可能比 Beckmann 表现稍差。
	}

	#Phong 分布函数
	{
		公式:
			D(h) = (n + 2) / (2π) * cos^n(θ_h)
			- n：反射指数，数值越大表面越光滑。
		特点:
			- 是一种经典分布函数，源自 Phong 着色模型。
			- 不基于物理原理，但计算简单。
		优点:
			- 适合初学者使用，易于理解。
			- 计算效率高。
		缺点:
			- 不符合能量守恒。
			- 无法准确模拟真实表面，尤其在粗糙材质中。
	}

	#Blinn-Phong 分布函数
	{
		公式:
			D(h) = (n + 8) / (8π) * (N · H)^n
			- n：高光指数，数值越大表示表面越光滑。
		特点:
			- 是 Phong 分布的改进版本，通过使用半程向量 H 来替代镜面方向计算。
		优点:
			- 比 Phong 更物理合理，计算效率高。
			- 易于实现，适合早期的实时渲染。
		缺点:
			- 对粗糙材质的表现较差。
			- 同样不完全符合能量守恒。
	}

	#Ashikhmin-Shirley 分布函数
	{
		公式:
			D(h) = sqrt((n_x + 1)(n_y + 1)) / (2π) * (H · N)^(n_x (H · T)^2 + n_y (H · B)^2)
			- n_x, n_y：分别控制切线方向和副法线方向的粗糙度。
			- T, B：切线和副法线。
		特点:
			- 支持各向异性材质（如拉丝金属）。
			- 粗糙度可在不同方向上独立控制。
		优点:
			- 能精确模拟各向异性表面。
			- 适用于高质量离线渲染。
		缺点:
			- 计算量较大。
			- 参数较难直观调整。
	}

	#Modified Beckmann 分布函数
	{
		公式:
			D(h) = 1 / (π α^2 cos^4(θ_h)) * exp(-tan^2(θ_h) / α^2) * F_mod
			- F_mod：修正项，用于补偿 Beckmann 分布在粗糙材质上的不足。
		特点:
			- 改进了 Beckmann 在粗糙材质上的表现。
			- 更符合能量守恒。
		优点:
			- 精确且适用范围更广。
			- 能平衡光滑和粗糙材质的表现。
		缺点:
			- 计算复杂度比原始 Beckmann 更高。
	}

	#总结：各分布函数对比
	| 分布函数            | 特点                               | 优点                          | 缺点                          | 适用场景                |
	|--------------------|-----------------------------------|------------------------------|------------------------------	|-------------------------|
	| Beckmann           | 快速衰减                           | 精确，适合光滑表面          		| 不适合粗糙材质              		| 玻璃、抛光金属          |
	| GGX                | 长尾分布，慢速衰减                   | 适合粗糙材质，现代 PBR 标准  	| 对光滑表面表现稍逊          		| 粗糙金属、塑料          |
	| Phong              | 经典简化模型                        | 易于实现，效率高            	| 不符合物理规律              		| 早期实时渲染            |
	| Blinn-Phong        | Phong 的改进版                     | 高效，略符合物理规律        		| 不适合粗糙材质              		| 实时渲染                |
	| Ashikhmin-Shirley  | 支持各向异性                        | 精确模拟各向异性材质        		| 参数复杂，计算量大          		| 拉丝金属、织物          |
	| Modified Beckmann  | 修正了 Beckmann 在粗糙材质上的不足    | 精确且范围广                	| 计算复杂度较高              		| 复杂材质，离线渲染      |

	#推荐使用:
	- 实时渲染: GGX 是目前的主流选择，适用于大部分场景
	- 高质量渲染: 复杂材质可使用 Ashikhmin-Shirley 或 Modified Beckmann
	- 简单场景或早期项目: 可选用 Blinn-Phong 或 Phong
}

#Cook-Torrance Specular F模型
{
	
}